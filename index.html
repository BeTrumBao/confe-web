<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Confe</title>
    <link rel="icon" type="image/x-icon" href="assets/favicon.png">
    <link rel="shortcut icon" href="assets/favicon.png">
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #0084ff;
            --primary-light: #e7f3ff;
            --sidebar-bg: #ffffff;
            --sidebar-text: #4B5563;
            --sidebar-hover: #F3F4F6;
            --border: #E5E7EB;
            --bg: #F9FAFB;
            --content-bg: #F3F4F6;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Outfit', sans-serif;
        }

        body {
            display: flex;
            height: 100vh;
            overflow: hidden;
            background: var(--bg);
            transition: background 0.3s ease;
        }

        .sidebar {
            width: 260px;
            min-width: 180px;
            max-width: 500px;
            background: var(--sidebar-bg);
            border-right: 1px solid var(--border);
            display: flex;
            flex-direction: column;
            padding: 24px;
            box-shadow: 2px 0 10px rgba(0, 0, 0, 0.02);
            z-index: 10;
            position: relative;
        }

        .resizer {
            width: 4px;
            height: 100%;
            background: transparent;
            position: absolute;
            right: 0;
            top: 0;
            cursor: col-resize;
            transition: background 0.2s;
        }

        .resizer:hover,
        .resizer.dragging {
            background: var(--primary);
        }

        .logo {
            font-size: 24px;
            font-weight: 800;
            color: var(--primary);
            margin-bottom: 40px;
            display: flex;
            align-items: center;
            gap: 10px;
            white-space: nowrap;
            overflow: hidden;
        }

        .logo img {
            width: 32px;
            height: 32px;
            border-radius: 8px;
            object-fit: cover;
            flex-shrink: 0;
        }

        .nav-link {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 14px 16px;
            border-radius: 12px;
            color: var(--sidebar-text);
            text-decoration: none;
            font-weight: 500;
            margin-bottom: 8px;
            transition: all 0.2s ease;
            cursor: pointer;
            white-space: nowrap;
            overflow: hidden;
        }

        .nav-link:hover,
        .nav-link.active {
            background: var(--primary-light);
            color: var(--primary);
        }

        .nav-link i {
            font-size: 20px;
            width: 24px;
            text-align: center;
            flex-shrink: 0;
        }

        .nav-items {
            flex: 1;
        }

        .nav-footer {
            padding-top: 20px;
            border-top: 1px solid var(--border);
            font-size: 13px;
            color: #9CA3AF;
            text-align: center;
            white-space: nowrap;
            overflow: hidden;
        }

        .content-area {
            flex: 1;
            background: var(--content-bg);
            position: relative;
            transition: background 0.3s ease;
        }

        iframe {
            width: 100%;
            height: 100%;
            border: none;
            display: block;
            overflow-y: auto;
        }

        #splash-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: #ffffff;
            z-index: 9999;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            margin: 0;
            padding: 0;
            transition: opacity 0.5s ease-out, visibility 0.5s;
        }

        #splash-screen.hidden {
            opacity: 0;
            visibility: hidden;
        }

        .splash-logo {
            width: 80px;
            height: 80px;

            animation: rotateIn 1.2s cubic-bezier(0.25, 1, 0.5, 1) forwards;
            margin-bottom: 20px;
            opacity: 0;
        }

        @keyframes rotateIn {
            0% {
                transform: rotate(-90deg) scale(0.8);
                opacity: 0;
            }

            100% {
                transform: rotate(0deg) scale(1);
                opacity: 1;
            }
        }

        .splash-text {
            font-size: 32px;
            font-weight: 800;
            color: var(--primary);
            opacity: 0;
            transform: translateY(20px);
            animation: fadeInUp 0.8s ease-out forwards 0.5s;
        }

        @keyframes fadeInUp {
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @media (max-width: 768px) {
            body {
                flex-direction: column-reverse;
            }

            .sidebar {
                position: relative;

                width: 100% !important;
                height: 70px;
                flex-direction: row;
                justify-content: space-around;
                padding: 0;
                border-top: 1px solid var(--border);
                border-right: none;
                z-index: 1000;
                background: white;

                box-shadow: 0 -4px 15px rgba(0, 0, 0, 0.05);
            }

            .logo,
            .nav-footer,
            .resizer,
            #sidebarFooter {
                display: none !important;
            }

            .nav-items {
                display: flex;
                width: 100%;
                justify-content: space-around;
                align-items: center;
                height: 100%;
            }

            .nav-link {
                flex: 1;
                flex-direction: column;
                gap: 4px;
                padding: 6px;
                font-size: 10px;
                margin: 0;
                border-radius: 0;
                background: transparent !important;
                color: #94a3b8;
                justify-content: center;
                text-align: center;
            }



            .nav-link.active {
                color: var(--primary);
            }

            .nav-link i {
                font-size: 22px;
                width: auto;
            }

            .nav-link span {
                font-weight: 600;
            }

            .content-area {
                flex: 1;

                height: auto;

                width: 100%;
                overflow: hidden;
            }

            body {
                height: 100dvh;

            }
        }
    </style>

    <link href="https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css" rel="stylesheet">
</head>

<body>
    <div id="splash-screen">
        <img src="assets/favicon.png" class="splash-logo">
        <div class="splash-text">Confe</div>
    </div>

    <script>
        window.addEventListener('load', () => { setTimeout(() => { document.getElementById('splash-screen').classList.add('hidden'); }, 1500); });



        window.setUid = (uid) => {
            const el = document.getElementById('uidText');
            if (el) el.textContent = uid || '‚Äî';
        }

        // Generate or recover a persistent deviceId
        function getDeviceId() {
            let did = localStorage.getItem('confe_device_id');
            if (!did) { did = 'dev-' + Math.random().toString(36).slice(2, 10); localStorage.setItem('confe_device_id', did); }
            const el = document.getElementById('deviceText');
            if (el) el.textContent = did;
        }
        getDeviceId();

        window.copyDbgField = (spanId, label) => {
            const el = document.getElementById(spanId);
            if (!el) return;
            const val = el.textContent;
            navigator.clipboard.writeText(val).then(() => {
                const orig = el.textContent;
                el.textContent = 'ƒê√£ ch√©p!';
                setTimeout(() => el.textContent = orig, 1200);
            });
        }
    </script>

    <div class="sidebar" id="sidebar">
        <div class="resizer" id="resizer"></div>
        <div class="logo">
            <img src="assets/favicon.png" alt="Logo"> Confe
        </div>

        <div class="nav-items" id="navItems">
            <div class="nav-link active" onclick="loadPage('dashboard.html', this)">
                <i class='bx bxs-home-smile'></i>
                <span>Trang ch·ªß</span>
            </div>
            <div class="nav-link" onclick="loadPage('chat.html', this)" style="position: relative;">
                <i class='bx bxs-message-rounded-dots'></i>
                <div id="chatBadge" class="badge-dot" style="display:none;"></div>
                <span>Tr√≤ chuy·ªán</span>
            </div>
            <div class="nav-link" onclick="loadPage('home.html', this)">
                <i class='bx bxs-category'></i>
                <span>Ch·ªß ƒë·ªÅ</span>
            </div>
            <div class="nav-link" onclick="loadPage('profile.html', this)">
                <i class='bx bxs-user'></i>
                <span>T√¥i</span>
            </div>
        </div>

        <div id="sidebarFooter"
            style="padding: 12px 16px; font-size: 11px; color: #94a3b8; border-top: 1px solid #f1f5f9; margin-top: 8px;">
            <div style="font-weight: 600; margin-bottom: 4px;">Confe Web</div>
            <div id="dbg-ver">ver: <span style="font-weight:700; color: #64748b;" id="versionText">1.5.0</span></div>
            <div id="dbg-configver" style="margin-top:2px;">configver: <span style="font-weight:700; color: #64748b;"
                    id="configVerText">‚Äî</span></div>

        </div>
    </div>
    <div id="modalAnnounce" class="modal"
        style="display:none; position:fixed; inset:0; background:rgba(0,0,0,0.5); z-index:5000; align-items:center; justify-content:center; backdrop-filter:blur(5px);">
        <div
            style="background:white; width:90%; max-width:350px; border-radius:24px; padding:20px; text-align:center; position:relative; box-shadow:0 20px 50px rgba(0,0,0,0.3);">
            <button onclick="document.getElementById('modalAnnounce').style.display='none'"
                style="position:absolute; top:15px; right:15px; width:30px; height:30px; border-radius:50%; background:#f1f5f9; border:none; cursor:pointer;"></button>
            <img id="annImg" src=""
                style="width:100%; height:180px; object-fit:cover; border-radius:16px; margin-bottom:15px; display:none;">
            <h3 style="margin-bottom:10px; font-size:18px;"> Th√¥ng b√°o</h3>
            <p id="annText" style="color:#64748b; font-size:14px; line-height:1.5;">...</p>

            <div
                style="margin-top:10px; margin-bottom:20px; display:flex; align-items:center; justify-content:flex-start; gap:8px;">
                <input type="checkbox" id="chkNoShow" style="width:16px; height:16px; cursor:pointer;">
                <label for="chkNoShow" style="font-size:13px; color:#64748b; cursor:pointer;">Kh√¥ng hi·ªán l·∫°i h√¥m
                    nay</label>
            </div>
            <button onclick="closeAnnounce()"
                style="width:100%; padding:12px; background:#2563eb; color:white; border:none; border-radius:12px; font-weight:700; cursor:pointer;">ƒê√£
                hi·ªÉu</button>
        </div>
    </div>

    <div id="modalMaintenance"
        style="display:none; position:fixed; inset:0; background:rgba(0,0,0,0.6); z-index:6000; align-items:center; justify-content:center; backdrop-filter:blur(8px);">
        <div
            style="background:#FDFBFF; width:90%; max-width:420px; border-radius:28px; padding:40px 32px; text-align:center; box-shadow:0px 8px 32px rgba(0,0,0,0.24);">

            <h1
                style="font-size:24px; font-weight:500; color:#1A1C1E; margin-bottom:12px; letter-spacing:0; line-height:32px; font-family:'Roboto',sans-serif;">
                ƒêang b·∫£o tr√¨ h·ªá th·ªëng
            </h1>

            <p id="maintenanceMessage"
                style="font-size:15px; font-weight:400; color:#44464F; line-height:22px; letter-spacing:0.25px; font-family:'Roboto',sans-serif;">
                Ch√∫ng t√¥i ƒëang n√¢ng c·∫•p h·ªá th·ªëng ƒë·ªÉ mang ƒë·∫øn tr·∫£i nghi·ªám t·ªët h∆°n cho b·∫°n. Vui l√≤ng quay l·∫°i sau!
            </p>
        </div>
    </div>
    <div id="tutorialOverlay" class="tutorial-overlay" onclick="closeTutorial()">
        <div class="tutorial-card" onclick="event.stopPropagation()">
            <h3 style="margin-bottom: 8px; font-size: 18px;"> Tr√≤ chuy·ªán</h3>
            <p style="font-size: 14px; color: #64748b; margin-bottom: 16px;">
                B·∫•m v√†o ƒë√¢y ƒë·ªÉ nh·∫Øn tin v·ªõi b·∫°n b√® ngay nh√©!
            </p>
            <button onclick="closeTutorial()"
                style="padding: 8px 24px; background: var(--primary); color: white; border: none; border-radius: 99px; font-weight: 600; cursor: pointer;">
                ƒê√£ hi·ªÉu
            </button>
        </div>
    </div>
    <div id="modalGuidelines" class="modal-guidelines" style="display: none;">
        <div class="guidelines-box">
            <div class="guidelines-header">
                <h2>Ô∏è Quy t·∫Øc c·ªông ƒë·ªìng</h2>
                <p>Vui l√≤ng ƒë·ªçc k·ªπ v√† k√©o xu·ªëng cu·ªëi ƒë·ªÉ ƒë·ªìng √Ω.</p>
            </div>

            <div id="guideContent" class="guide-content-scroll" onscroll="checkScroll(this)">
                <ul class="rule-list">
                    <li> <strong>Kh√¥ng spam:</strong> Kh√¥ng ƒëƒÉng li√™n t·ª•c c√°c topic gi·ªëng nhau, b√¨nh lu·∫≠n v√¥ nghƒ©a
                        ho·∫∑c spam icon.</li>
                    <li> <strong>Ng√¥n t·ª´:</strong> Kh√¥ng s·ª≠ d·ª•ng ng√¥n t·ª´ t·ª•c tƒ©u, ch·ª≠i th·ªÅ, x√∫c ph·∫°m danh d·ª± nh√¢n ph·∫©m
                        ng∆∞·ªùi kh√°c.</li>
                    <li> <strong>N·ªôi dung c·∫•m:</strong> Nghi√™m c·∫•m m·ªçi h√†nh vi chia s·∫ª n·ªôi dung ƒë·ªìi tr·ª•y, b·∫°o l·ª±c,
                        k√≠ch ƒë·ªông th√π h·∫±n ho·∫∑c vi ph·∫°m ph√°p lu·∫≠t Vi·ªát Nam.</li>
                    <li>fake <strong>Tin gi·∫£:</strong> Kh√¥ng lan truy·ªÅn th√¥ng tin sai l·ªách, tin ƒë·ªìn th·∫•t thi·ªát ch∆∞a ƒë∆∞·ª£c
                        ki·ªÉm ch·ª©ng g√¢y hoang mang d∆∞ lu·∫≠n.</li>
                    <li> <strong>Qu·∫£ng c√°o:</strong> Kh√¥ng qu·∫£ng c√°o tr√°i ph√©p, spam link c·ªù b·∫°c, c√° ƒë·ªô, vay n·∫∑ng l√£i
                        ho·∫∑c c√°c d·ªãch v·ª• kh√¥ng ƒë∆∞·ª£c ph√©p.</li>
                    <li> <strong>T√¥n tr·ªçng:</strong> T√¥n tr·ªçng s·ª± kh√°c bi·ªát, th·∫£o lu·∫≠n tr√™n tinh th·∫ßn x√¢y d·ª±ng, kh√¥ng
                        c√¥ng k√≠ch c√° nh√¢n.</li>
                    <li> <strong>B·∫£o m·∫≠t:</strong> Tuy·ªát ƒë·ªëi kh√¥ng chia s·∫ª m·∫≠t kh·∫©u, m√£ OTP, s·ªë ƒëi·ªán tho·∫°i, ƒë·ªãa ch·ªâ
                        nh√† ri√™ng ho·∫∑c th√¥ng tin nh·∫°y c·∫£m c·ªßa b·∫£n th√¢n v√† ng∆∞·ªùi kh√°c c√¥ng khai.</li>
                    <li>u <strong>Ti·∫øng Vi·ªát trong s√°ng:</strong> Gi·ªØ g√¨n s·ª± trong s√°ng c·ªßa Ti·∫øng Vi·ªát, h·∫°n ch·∫ø vi·∫øt t·∫Øt
                        qu√° m·ª©c g√¢y kh√≥ hi·ªÉu, kh√¥ng teencode qu√° ƒë√†.</li>
                    <li> <strong>Qu·∫•y r·ªëi:</strong> Nghi√™m c·∫•m h√†nh vi nh·∫Øn tin l√†m phi·ªÅn, qu·∫•y r·ªëi t√¨nh d·ª•c, ƒëe d·ªça
                        ho·∫∑c kh·ªßng b·ªë tinh th·∫ßn th√†nh vi√™n kh√°c.</li>
                    <li> <strong>Link l·∫°:</strong> C·∫©n th·∫≠n v·ªõi c√°c ƒë∆∞·ªùng link l·∫°, kh√¥ng click n·∫øu kh√¥ng r√µ ngu·ªìn g·ªëc
                        ƒë·ªÉ tr√°nh m·∫•t t√†i kho·∫£n.</li>
                    <li> <strong>Bot/Tool:</strong> Kh√¥ng s·ª≠ d·ª•ng tool, bot spam tin nh·∫Øn, auto comment g√¢y ·∫£nh h∆∞·ªüng
                        ƒë·∫øn tr·∫£i nghi·ªám ng∆∞·ªùi d√πng kh√°c.</li>
                    <li>impersonate <strong>M·∫°o danh:</strong> Kh√¥ng m·∫°o danh Admin, Moderator ho·∫∑c ng∆∞·ªùi n·ªïi ti·∫øng ƒë·ªÉ
                        l·ª´a ƒë·∫£o tr·ª•c l·ª£i.</li>
                    <li>copyright <strong>B·∫£n quy·ªÅn:</strong> T√¥n tr·ªçng b·∫£n quy·ªÅn t√°c gi·∫£, ghi r√µ ngu·ªìn khi chia s·∫ª n·ªôi
                        dung kh√¥ng ph·∫£i c·ªßa m√¨nh.</li>
                    <li>report <strong>B√°o c√°o vi ph·∫°m:</strong> T√≠ch c·ª±c b√°o c√°o c√°c n·ªôi dung x·∫•u ƒë·ªôc ƒë·ªÉ c√πng ƒë·ªôi ng≈©
                        qu·∫£n tr·ªã x√¢y d·ª±ng c·ªông ƒë·ªìng s·∫°ch ƒë·∫πp.</li>
                    <li>punish <strong>X·ª≠ l√Ω vi ph·∫°m:</strong> C√°c t√†i kho·∫£n vi ph·∫°m s·∫Ω b·ªã kh√≥a t·∫°m th·ªùi ho·∫∑c vƒ©nh vi·ªÖn
                        t√πy theo m·ª©c ƒë·ªô nghi√™m tr·ªçng m√† kh√¥ng c·∫ßn b√°o tr∆∞·ªõc.</li>
                    <li> <strong>T√†i kho·∫£n:</strong> B·∫°n ch·ªãu tr√°ch nhi·ªám ho√†n to√†n v·ªÅ c√°c ho·∫°t ƒë·ªông di·ªÖn ra tr√™n t√†i
                        kho·∫£n c·ªßa m√¨nh. H√£y b·∫£o m·∫≠t m·∫≠t kh·∫©u c·∫©n th·∫≠n.</li>

                    <li> <strong>C·ªù b·∫°c:</strong> Nghi√™m c·∫•m t·ªï ch·ª©c, r·ªß r√™ c√° ƒë·ªô, l√¥ ƒë·ªÅ, c·ªù b·∫°c d∆∞·ªõi m·ªçi h√¨nh th·ª©c.
                    </li>
                    <li>ü©∏ <strong>K√≠ch ƒë·ªông:</strong> Kh√¥ng ƒëƒÉng t·∫£i n·ªôi dung k√≠ch ƒë·ªông b·∫°o l·ª±c, t·ª± l√†m h·∫°i b·∫£n th√¢n
                        ho·∫∑c c·ªï s√∫y cho c√°c h√†nh vi nguy hi·ªÉm.</li>
                    <li>Ô∏è <strong>Th√π gh√©t:</strong> Kh√¥ng ph√¢n bi·ªát ch·ªßng t·ªôc, t√¥n gi√°o, gi·ªõi t√≠nh, v√πng mi·ªÅn. M·ªçi
                        h√†nh vi k·ª≥ th·ªã ƒë·ªÅu b·ªã nghi√™m c·∫•m.</li>
                    <li> <strong>Avatar/B√¨a:</strong> Kh√¥ng s·ª≠ d·ª•ng h√¨nh ·∫£nh nh·∫°y c·∫£m, ƒë·ªìi tr·ª•y, kinh d·ªã ho·∫∑c vi ph·∫°m
                        b·∫£n quy·ªÅn l√†m ·∫£nh ƒë·∫°i di·ªán, ·∫£nh b√¨a.</li>
                    <li>Ô∏è <strong>T√™n hi·ªÉn th·ªã:</strong> Kh√¥ng ƒë·∫∑t t√™n gi·∫£ m·∫°o ng∆∞·ªùi n·ªïi ti·∫øng, t√™n ch·ª©a t·ª´ ng·ªØ th√¥
                        t·ª•c ho·∫∑c t√™n g√¢y nh·∫ßm l·∫´n v·ªõi ƒë·ªôi ng≈© qu·∫£n tr·ªã.</li>
                    <li> <strong>Spam Flooding:</strong> Kh√¥ng g·ª≠i tin nh·∫Øn li√™n ti·∫øp qu√° nhanh (flood) g√¢y tr√¥i tin
                        nh·∫Øn c·ªßa ng∆∞·ªùi kh√°c trong nh√≥m chat.</li>
                    <li> <strong>L·ª£i d·ª•ng l·ªói:</strong> N·∫øu ph√°t hi·ªán l·ªói (bug) c·ªßa h·ªá th·ªëng, vui l√≤ng b√°o c√°o cho
                        Admin, kh√¥ng l·ª£i d·ª•ng l·ªói ƒë·ªÉ tr·ª•c l·ª£i ho·∫∑c ph√° ho·∫°i.</li>
                    <li> <strong>K√™u g·ªçi:</strong> Kh√¥ng k√™u g·ªçi t·∫©y chay, t·∫•n c√¥ng c√° nh√¢n ho·∫∑c t·ªï ch·ª©c kh√°c tr√™n n·ªÅn
                        t·∫£ng.</li>
                    <li> <strong>Giao d·ªãch:</strong> C·∫©n tr·ªçng khi giao d·ªãch ti·ªÅn b·∫°c, v·∫≠t ph·∫©m v·ªõi ng∆∞·ªùi l·∫°. Confe
                        kh√¥ng ch·ªãu tr√°ch nhi·ªám v·ªÅ c√°c giao d·ªãch c√° nh√¢n.</li>
                    <li>Ô∏è <strong>Doxxing:</strong> Tuy·ªát ƒë·ªëi kh√¥ng t√¨m ki·∫øm, chia s·∫ª th√¥ng tin ƒë·ªùi t∆∞ c·ªßa ng∆∞·ªùi kh√°c
                        (doxxing) khi ch∆∞a ƒë∆∞·ª£c s·ª± ƒë·ªìng √Ω.</li>
                    <li>Ô∏è <strong>Tu√¢n th·ªß ph√°p lu·∫≠t:</strong> M·ªçi h√†nh vi vi ph·∫°m ph√°p lu·∫≠t n∆∞·ªõc C·ªông h√≤a X√£ h·ªôi Ch·ªß
                        nghƒ©a Vi·ªát Nam ƒë·ªÅu b·ªã c·∫•m v√† c√≥ th·ªÉ b·ªã truy t·ªë.</li>
                    <li>Ô∏è <strong>H·ª£p t√°c:</strong> Vui l√≤ng h·ª£p t√°c v·ªõi Mod/Admin khi ƒë∆∞·ª£c y√™u c·∫ßu cung c·∫•p th√¥ng tin
                        ƒë·ªÉ gi·∫£i quy·∫øt khi·∫øu n·∫°i, t·ªë c√°o.</li>
                    <li> <strong>S·ª≠a ƒë·ªïi:</strong> Quy t·∫Øc n√†y c√≥ th·ªÉ ƒë∆∞·ª£c c·∫≠p nh·∫≠t b·∫•t c·ª© l√∫c n√†o ƒë·ªÉ ph√π h·ª£p v·ªõi t√¨nh
                        h√¨nh th·ª±c t·∫ø. Vi·ªác b·∫°n ti·∫øp t·ª•c s·ª≠ d·ª•ng Confe ƒë·ªìng nghƒ©a v·ªõi vi·ªác b·∫°n ƒë·ªìng √Ω v·ªõi c√°c thay ƒë·ªïi
                        ƒë√≥.</li>
                </ul>
                <div style="height: 20px;"></div>
            </div>

            <div class="actions-area">
                <button id="btnAgree" class="btn-agree disabled" onclick="closeGuidelines()" disabled>ƒê·ªçc h·∫øt ƒë·ªÉ ƒë·ªìng
                    √Ω</button>
            </div>
        </div>
    </div>

    <style>
        .spinner-circular {
            width: 48px;
            height: 48px;
            border: 4px solid #E1E2EC;
            border-top-color: #1565C0;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }

        @keyframes float {

            0%,
            100% {
                transform: translateY(0px);
            }

            50% {
                transform: translateY(-10px);
            }
        }

        .badge-dot {
            position: absolute;
            top: 5px;
            right: 15px;
            width: 10px;
            height: 10px;
            background-color: #ef4444;
            border-radius: 50%;
            border: 2px solid white;
            z-index: 10;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% {
                transform: scale(0.95);
                box-shadow: 0 0 0 0 rgba(239, 68, 68, 0.7);
            }

            70% {
                transform: scale(1);
                box-shadow: 0 0 0 10px rgba(239, 68, 68, 0);
            }

            100% {
                transform: scale(0.95);
                box-shadow: 0 0 0 0 rgba(239, 68, 68, 0);
            }
        }

        .tutorial-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.7);
            z-index: 8000;
            display: none;

            flex-direction: column;
            align-items: center;
            justify-content: center;
            backdrop-filter: blur(2px);
        }

        .tutorial-card {
            background: white;
            padding: 24px;
            border-radius: 20px;
            text-align: center;
            max-width: 300px;
            animation: zoomIn 0.3s ease;
            position: relative;
        }

        @media (max-width: 768px) {
            .tutorial-overlay {
                justify-content: flex-end;
                padding-bottom: 90px;

            }
        }

        .modal-guidelines {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.6);
            z-index: 7000;
            display: flex;
            justify-content: center;
            align-items: center;
            backdrop-filter: blur(8px);
            animation: fadeIn 0.3s ease;
        }

        .guidelines-box {
            background: #ffffff;
            width: 90%;
            max-width: 500px;
            border-radius: 24px;
            padding: 30px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.2);
            display: flex;
            flex-direction: column;
            max-height: 80vh;

            animation: zoomIn 0.3s ease;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
            }

            to {
                opacity: 1;
            }
        }

        @keyframes zoomIn {
            from {
                opacity: 0;
                transform: scale(0.9);
            }

            to {
                opacity: 1;
                transform: scale(1);
            }
        }

        .guidelines-header {
            text-align: center;
            margin-bottom: 20px;
            flex-shrink: 0;
        }

        .guidelines-header h2 {
            font-size: 22px;
            font-weight: 800;
            color: var(--primary);
            margin-bottom: 8px;
        }

        .guidelines-header p {
            font-size: 14px;
            color: var(--text-light, #64748b);
        }

        .guide-content-scroll {
            flex: 1;
            overflow-y: auto;
            margin-bottom: 20px;
            padding-right: 8px;
            border: 1px solid #f1f5f9;
            border-radius: 12px;
            padding: 10px;
        }

        .guide-content-scroll::-webkit-scrollbar {
            width: 6px;
        }

        .guide-content-scroll::-webkit-scrollbar-track {
            background: #f1f5f9;
        }

        .guide-content-scroll::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 10px;
        }

        .guide-content-scroll::-webkit-scrollbar-thumb:hover {
            background: #94a3b8;
        }

        .rule-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .rule-list li {
            font-size: 14px;
            color: var(--text-main, #4B5563);
            margin-bottom: 12px;
            line-height: 1.6;
            padding: 10px;
            background: #f8fafc;
            border-radius: 12px;
            border: 1px solid #e2e8f0;
        }

        .rule-list li strong {
            color: var(--primary);
        }

        .actions-area {
            flex-shrink: 0;
        }

        .btn-agree {
            width: 100%;
            background: var(--primary);
            color: white;
            border: none;
            padding: 14px;
            border-radius: 16px;
            font-weight: 700;
            font-size: 15px;
            cursor: pointer;
            transition: 0.3s;
            box-shadow: 0 4px 12px rgba(0, 132, 255, 0.3);
        }

        .btn-agree:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(0, 132, 255, 0.4);
        }

        .btn-agree.disabled {
            background: #cbd5e1;
            color: #94a3b8;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
    </style>

    <div class="content-area">
        <iframe name="contentFrame" id="mainFrame" src="dashboard.html"></iframe>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";

        import {
            getAuth,
            onAuthStateChanged
        }

            from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

        import {
            getFirestore,
            doc,
            getDoc
        }

            from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        import {
            getRemoteConfig,
            fetchAndActivate,
            getValue
        }

            from "https://www.gstatic.com/firebasejs/10.7.1/firebase-remote-config.js";

        const cfg = {
            apiKey: "AIzaSyBPEMno1uZFg4uVXZjz-PbBR37gH6-3t5Y", authDomain: "confe-web.firebaseapp.com", projectId: "confe-web", storageBucket: "confe-web.firebasestorage.app", messagingSenderId: "677778119372", appId: "1:677778119372:web:ee3f1132871332743b0069"
        }

            ;
        const app = initializeApp(cfg);
        const auth = getAuth(app);
        const db = getFirestore(app);
        const remoteConfig = getRemoteConfig(app);

        // AUTH & SETUP CHECK
        onAuthStateChanged(auth, async (u) => {
            if (u) {
                localStorage.setItem('confe_current_uid', u.uid);
                const snap = await getDoc(doc(db, "users", u.uid));

                if (snap.exists()) {
                    const data = snap.data();

                }
            } else {
                localStorage.removeItem('confe_current_uid');
            }
        });

        // REMOTE CONFIG ANNOUNCEMENT
        remoteConfig.settings.minimumFetchIntervalMillis = 3600;

        window.closeAnnounce = () => {
            if (document.getElementById('chkNoShow').checked) {
                localStorage.setItem('ann_hide_date', new Date().toDateString());
            }

            document.getElementById('modalAnnounce').style.display = 'none';
        }

        fetchAndActivate(remoteConfig).then(() => {
            // SHOW CONFIG VERSION
            try {
                const configVer = getValue(remoteConfig, 'config_version').asString();
                const configVerEl = document.getElementById('configVerText');
                if (configVerEl && configVer) configVerEl.textContent = configVer;
            } catch (e) { }

            // CHECK MAINTENANCE MODE
            const maintenanceMode = getValue(remoteConfig, 'maintenance_mode').asBoolean();

            if (maintenanceMode) {
                // Show maintenance modal instead of redirect
                const customMessage = getValue(remoteConfig, 'maintenance_message').asString();

                if (customMessage) {
                    document.getElementById('maintenanceMessage').textContent = customMessage;
                }

                document.getElementById('modalMaintenance').style.display = 'flex';
                return;
            }


            const today = new Date().toDateString();
            if (localStorage.getItem('ann_hide_date') === today) return; // SKIP IF HIDDEN TODAY
            const val = getValue(remoteConfig, "announcement_data");

            try {
                const data = JSON.parse(val.asString());

                if (data && data.show) {
                    const modal = document.getElementById('modalAnnounce');
                    const img = document.getElementById('annImg');
                    const txt = document.getElementById('annText');

                    if (data.image) {
                        img.src = data.image; img.style.display = 'block';
                    }

                    else {
                        img.style.display = 'none';
                    }

                    txt.textContent = data.text || "Th√¥ng b√°o t·ª´ h·ªá th·ªëng.";
                    modal.style.display = 'flex';
                }
            }

            catch (e) {
                console.log("No announcement or parse error");
            }
        });

        // GUIDELINES LOGIC
        function checkGuidelines() {
            console.log("Checking guidelines...");
            const lastSeen = localStorage.getItem('confe_guidelines_last_seen');
            const now = new Date().getTime();
            const oneWeek = 7 * 24 * 60 * 60 * 1000;

            // FOR DEBUG: Always clear last seen to force show on refresh if user wants testing
            // localStorage.removeItem('confe_guidelines_last_seen'); 

            if (!lastSeen || (now - parseInt(lastSeen)) > oneWeek) {
                console.log("Showing guidelines modal");
                const modal = document.getElementById('modalGuidelines');
                modal.style.display = 'flex';
                // Reset button state and check scroll position immediately
                const btn = document.getElementById('btnAgree');
                btn.classList.add('disabled');
                btn.setAttribute('disabled', 'true');
                btn.textContent = "ƒê·ªçc h·∫øt ƒë·ªÉ ƒë·ªìng √Ω";
                const guideContent = document.getElementById('guideContent');

                if (guideContent) {
                    // Ensure content is rendered before checking scroll
                    setTimeout(() => checkScroll(guideContent), 100);
                }
            }

            else {
                console.log("Guidelines already seen recently.");
            }
        }

        // Run immediately
        checkGuidelines();

        // TUTORIAL & BADGE LOGIC
        function checkTutorial() {
            const hasSeenTutorial = localStorage.getItem('confe_chat_tutorial_seen');
            const chatBadge = document.getElementById('chatBadge');

            if (!hasSeenTutorial) {
                // Show badge
                if (chatBadge) chatBadge.style.display = 'block';

                // Show tutorial overlay
                const tutorial = document.getElementById('tutorialOverlay');
                if (tutorial) {
                    tutorial.style.display = 'block'; // Changed from flex to block for absolute positioning

                    // SPOTLIGHT EFFECT & POSITIONING
                    const chatLink = document.querySelector('.nav-link[onclick*="chat.html"]');
                    const sidebar = document.getElementById('sidebar');
                    const card = tutorial.querySelector('.tutorial-card');

                    if (chatLink && sidebar && card) {
                        // High z-index for spotlight
                        sidebar.style.zIndex = '8001';
                        chatLink.style.zIndex = '8002';
                        chatLink.style.position = 'relative';
                        chatLink.style.background = '#fff'; // Highlight background
                        chatLink.style.borderRadius = '12px';
                        chatLink.id = 'tut-highlight-link'; // Marker to clear later

                        // Calculate Position
                        const rect = chatLink.getBoundingClientRect();
                        const isMobile = window.innerWidth <= 768;

                        if (isMobile) {
                            // Mobile: Position above (Arrow points DOWN)
                            card.style.position = 'absolute';
                            card.style.left = (rect.left + rect.width / 2) + 'px';
                            card.style.top = (rect.top - card.offsetHeight - 40) + 'px'; // Move up for arrow (40px)
                            card.style.transform = 'translateX(-50%)';

                            // Arrow pointing DOWN (to the button)
                            const arrow = document.createElement('div');
                            arrow.id = 'tut-arrow-icon';
                            arrow.innerHTML = `
                                <svg width="40" height="40" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" style="filter: drop-shadow(0 2px 4px rgba(255,255,255,0.5));">
                                    <path d="M12 4V20M12 20L18 14M12 20L6 14" stroke="#000000" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"/>
                                </svg>
                            `;
                            arrow.style.position = 'absolute';
                            arrow.style.zIndex = '9999';
                            // Position directly below the card
                            // Card Top + Height + Spacing? No, arrow top = Card Bottom
                            // Let's use Rect Top - Arrow Height
                            arrow.style.top = (rect.top - 45) + 'px';
                            arrow.style.left = (rect.left + rect.width / 2) + 'px';
                            arrow.style.transform = 'translateX(-50%)';
                            arrow.style.animation = 'bounceDown 1s infinite';
                            document.body.appendChild(arrow);

                        } else {
                            // Desktop: Position to the right (Arrow points LEFT)
                            card.style.position = 'absolute';
                            card.style.left = (rect.right + 50) + 'px'; // Move right for arrow space (50px)
                            card.style.top = (rect.top + rect.height / 2) + 'px';
                            card.style.transform = 'translateY(-50%)';

                            // Arrow pointing LEFT (to the button)
                            const arrow = document.createElement('div');
                            arrow.id = 'tut-arrow-icon';
                            arrow.innerHTML = `
                                <svg width="40" height="40" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" style="filter: drop-shadow(0 2px 4px rgba(255,255,255,0.5));">
                                    <path d="M20 12H4M4 12L10 18M4 12L10 6" stroke="#000000" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"/>
                                </svg>
                            `;
                            arrow.style.position = 'absolute';
                            arrow.style.zIndex = '9999';
                            // Position to the left of card
                            // Arrow Right = Card Left? No, arrow left = Rect Right + Spacing
                            arrow.style.left = (rect.right + 10) + 'px'; // 10px from button
                            arrow.style.top = (rect.top + rect.height / 2) + 'px';
                            arrow.style.transform = 'translateY(-50%)';
                            arrow.style.animation = 'bounceLeft 1s infinite';
                            document.body.appendChild(arrow);
                        }

                        // Add Animations
                        const animStyle = document.createElement('style');
                        animStyle.id = 'tut-anim-style';
                        animStyle.innerHTML = `
                            @keyframes bounceDown {
                                0%, 100% { transform: translateX(-50%) translateY(0); }
                                50% { transform: translateX(-50%) translateY(5px); }
                            }
                            @keyframes bounceLeft {
                                0%, 100% { transform: translateY(-50%) translateX(0); }
                                50% { transform: translateY(-50%) translateX(-5px); }
                            }
                        `;
                        document.head.appendChild(animStyle);
                    }
                }
            }
        }

        window.closeTutorial = () => {
            const tutorial = document.getElementById('tutorialOverlay');
            if (tutorial) tutorial.style.display = 'none';

            // SAVE STATE
            localStorage.setItem('confe_chat_tutorial_seen', 'true');

            // CLEANUP SPOTLIGHT
            const sidebar = document.getElementById('sidebar');
            if (sidebar) sidebar.style.zIndex = '';

            const chatLink = document.getElementById('tut-highlight-link');
            if (chatLink) {
                chatLink.style.zIndex = '';
                chatLink.style.position = 'relative'; // Keep relative for badge
                chatLink.style.background = '';
                chatLink.style.borderRadius = '';
                chatLink.id = '';
            }

            const arrow = document.getElementById('tut-arrow-icon');
            if (arrow) arrow.remove();

            const animStyle = document.getElementById('tut-anim-style');
            if (animStyle) animStyle.remove();
        }

        // Hook into loadPage to hide badge and tutorial when Chat is clicked
        const originalLoadPage = window.loadPage;
        window.loadPage = function (url, el) {
            if (url.includes('chat.html')) {
                localStorage.setItem('confe_chat_tutorial_seen', 'true');
                const chatBadge = document.getElementById('chatBadge');
                if (chatBadge) chatBadge.style.display = 'none';
                closeTutorial();
            }
            // Call original logic (which is defined below, so we need to move this hook or redefining it)
            document.getElementById('mainFrame').src = url;

            // UI Active State
            document.querySelectorAll('.nav-link').forEach(link => link.classList.remove('active'));
            if (el) el.classList.add('active');
        }

        // Run tutorial check
        setTimeout(checkTutorial, 1000);

        window.closeGuidelines = () => {
            localStorage.setItem('confe_guidelines_last_seen', new Date().getTime().toString());
            document.getElementById('modalGuidelines').style.display = 'none';
        }

        window.checkScroll = (el) => {
            const btn = document.getElementById('btnAgree');

            // Check if scrolled to bottom (with small buffer)
            if (el.scrollHeight - el.scrollTop <= el.clientHeight + 20) {
                btn.classList.remove('disabled');
                btn.removeAttribute('disabled');
                btn.textContent = "T√¥i ƒë√£ hi·ªÉu v√† ƒë·ªìng √Ω";
            }

            else {
                btn.classList.add('disabled');
                btn.setAttribute('disabled', 'true');
                btn.textContent = "ƒê·ªçc h·∫øt ƒë·ªÉ ƒë·ªìng √Ω";
            }
        }

        window.loadPage = function (url, el) {
            document.getElementById('mainFrame').src = url;

            // UI Active State
            document.querySelectorAll('.nav-link').forEach(link => link.classList.remove('active'));
            if (el) el.classList.add('active');
        }


        // SIDEBAR RESIZER LOGIC
        const sidebar = document.getElementById('sidebar');
        const resizer = document.getElementById('resizer');
        const iframe = document.getElementById('mainFrame');
        let isResizing = false;

        resizer.addEventListener('mousedown', (e) => {
            isResizing = true;
            resizer.classList.add('dragging');
            document.body.style.cursor = 'col-resize';
            document.body.style.userSelect = 'none';
            iframe.style.pointerEvents = 'none'; // Prevent iframe from stealing events
        });

        document.addEventListener('mousemove', (e) => {
            if (!isResizing) return;
            let newWidth = e.clientX;

            // Clamp values
            if (newWidth < 180) newWidth = 180;
            if (newWidth > 500) newWidth = 500;

            sidebar.style.width = newWidth + 'px';
        });

        document.addEventListener('mouseup', () => {
            if (isResizing) {
                isResizing = false;
                resizer.classList.remove('dragging');
                document.body.style.cursor = 'default';
                document.body.style.userSelect = 'auto';
                iframe.style.pointerEvents = 'auto'; // Re-enable iframe events
            }
        });

        // X·ª≠ l√Ω Deep Link khi m·ªõi v√†o trang
        window.addEventListener('DOMContentLoaded', () => {
            const urlParams = new URLSearchParams(window.location.search);
            const uidParam = urlParams.get('uid');
            const viewParam = urlParams.get('view');
            const chatParam = urlParams.get('chat');
            const mainFrame = document.getElementById('mainFrame');

            if (uidParam) {
                // Remove active state from all nav links
                document.querySelectorAll('.nav-link').forEach(link => link.classList.remove('active'));
                mainFrame.src = `profile.html?uid=${uidParam}`;
            } else if (chatParam) {
                mainFrame.src = `chat.html?chat=${chatParam}`;
            }
        });
    </script>
</body>

</html>